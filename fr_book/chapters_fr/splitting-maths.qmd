---
title: "Évaluer les Divisions"
---

Dans la plupart des problèmes, les différents groupes ne peuvent pas être **séparés**. En revenant à l'exemple du diagnostic de tumeur, les données d'entraînement semblent désordonnées :

![Problème de classification du diagnostic de tumeur](/images/intro/scatter.png)

Comment pourrait-on construire un arbre à partir de là ?

## Meilleure Division en Premier

On pourrait commencer par trouver la **meilleure division**, la division qui sépare le mieux les données. La division créera deux groupes :

![Première division](/images/trees/example_first_split.png)

Pour chacun des nouveaux groupes, on peut trouver les **meilleures divisions**, les appliquer, et **créer deux nouveaux groupes** :

![Toutes les divisions](/images/trees/example_three_splits.png)

On peut continuer à diviser jusqu'à ce que les sous-groupes soient "purs" ; c'est-à-dire qu'il n'y a que des observations appartenant à la même classe.

En pratique, d'autres contraintes sont appliquées. En général, il est logique de limiter la **profondeur** d'un arbre pour que la taille du modèle résultant reste gérable. Ces modèles simples ont généralement de meilleures capacités de généralisation.

::: {.callout-note collapse="true"}
## Qu'est-ce que la profondeur d'un arbre ?

La profondeur d'un arbre est la **distance** du nœud racine, ici la première division, au nœud feuille, ici le dernier nœud, responsable de l'attribution de la prédiction.

Quelle est la profondeur de l'arbre construit dans les exemples précédents ?

![Arbre d'exemple](/images/trees/tree_example.png){width=50%}

Elle est de deux, car il y a deux arêtes (connexions) sur le chemin du nœud racine (en haut) au nœud feuille (en bas).

:::

## Coefficient d'Impureté de Gini

Comment mesureriez-vous la **qualité d'une division** ? Ou la pureté des groupes résultants ?

Imaginons que la Division 1 crée les deux groupes suivants :

| Groupe | Malin | Bénin |
|:------:|:-----:|:-----:|
| A      | 9     | 1     |
| B      | 2     | 8     |

Et que la Division 2 crée les deux groupes suivants :

| Groupe | Malin | Bénin |
|:------:|:-----:|:-----:|
| C      | 6     | 4     |
| D      | 5     | 5     |

Intuitivement, nous savons que la Division 1 a mieux fonctionné, car les sous-groupes résultants sont **plus homogènes**. Le groupe A contient principalement des observations malignes et le groupe B plus d'observations bénignes. En revanche, les groupes C et D sont tous deux mélangés. Mais comment quantifier cette intuition ?

C'est exactement ce que mesure le **Coefficient d'Impureté de Gini**.

Le Coefficient de Gini mesure l'"impureté" à travers la probabilité de choisir aléatoirement **deux éléments de classes différentes** dans le même groupe.

Mais pourquoi cette probabilité mesurerait-elle l'impureté ? Si cette probabilité est faible, cela signifie qu'il est peu probable de choisir des éléments de classes différentes. En d'autres termes, il est probable de choisir des éléments de la **même classe**. Cette probabilité sera de 0 si tous les éléments d'un groupe sont d'une seule classe.

D'un autre côté, lorsque cette probabilité est élevée, il est probable de choisir des éléments de classes différentes. Cela se produira lorsque le groupe est **mélangé**. Elle sera de 1 dans le cas extrême où le groupe ne contient qu'un seul élément de chaque classe.

Illustrons cela avec le groupe A dans le tableau ci-dessous :

| Groupe | Malin | Bénin |
|--------|-------|-------|
| A      | 9     | 1     |

Si nous choisissions aléatoirement deux éléments dans ce groupe (avec remise), quelle serait la probabilité de choisir des éléments **de deux classes différentes** (malin et bénin) ?

Essayez d'y réfléchir avant de continuer à lire.

Pour simplifier, quelle est la probabilité de choisir d'abord une tumeur maligne, puis une tumeur bénigne ?

Les probabilités de choisir une tumeur maligne et bénigne sont les suivantes :
$$
P(\text{malin}) = \frac{9}{9+1} = 0.9
$$
$$
P(\text{bénin}) = \frac{1}{9+1} = 0.1
$$

Comme les deux tirages sont aléatoires et avec remise, la probabilité de choisir l'un, puis l'autre est :

$$
P(\text{malin puis bénin}) = P(\text{malin}) \cdot P(\text{bénin}) = 0.9 \cdot 0.1 = 0.09
$$

Maintenant, quelle serait la probabilité de choisir une observation bénigne puis une maligne (en inversant l'ordre) ? Nous avons déjà calculé les probabilités ci-dessus, nous devons juste inverser l'ordre :
$$
P(\text{bénin puis malin}) = P(\text{bénin}) \cdot P(\text{malin}) = 0.1 \cdot 0.9 = 0.09
$$

Ce qui, **par symétrie**, donne les mêmes résultats. Comme cet échantillonnage est indépendant, la probabilité de choisir malin puis bénin est la même que bénin puis malin. Pour obtenir la probabilité de ces deux événements, nous devons simplement les additionner :

$$
\begin{aligned}
&= P(\text{malin puis bénin}) 
+ P(\text{bénin puis malin}) \\
&= 0.09 + 0.09 = 0.18
\end{aligned}
$$

Voilà, nous avons calculé le Coefficient d'Impureté de Gini pour le groupe A.

:::{.exercise #exr-gini}
Calculez le Coefficient d'Impureté de Gini pour le groupe B et montrez qu'il est de 0.32.

| Groupe | Malin | Bénin |
|--------|-------|-------|
| B      | 2     | 8     |
:::

Le Coefficient d'Impureté de Gini du groupe B est légèrement plus élevé que celui du groupe A, car il est légèrement plus mélangé.

### Évaluer les Divisions

Maintenant, revenons à la quantification de la qualité d'une division. Pour ce faire, nous calculerons le Coefficient de Gini moyen de chaque division.

Division 1 :

| Groupe | Malin | Bénin |
|--------|-------|-------|
| A      | 9     | 1     |
| B      | 2     | 8     |

Division 2 :

| Groupe | Malin | Bénin |
|--------|-------|-------|
| C      | 6     | 4     |
| D      | 5     | 5     |

Comme vu dans la section précédente, nous connaissons le Coefficient de Gini des groupes A et B : 0.18 et 0.32 respectivement.

Le Coefficient de Gini moyen pour la Division 1, groupes A et B, peut être calculé comme suit :

$$
\frac{n_a}{n_a + n_b} \cdot \text{Gini}_{a} + \frac{n_b}{n_a + n_b} \cdot \text{Gini}_{b}
$$

$$
\frac{10}{10+10} \cdot 0.18 + \frac{10}{10+10} \cdot 0.32 = 0.25
$$

:::{.exercise #exr-gini-split}
Calculez les Coefficients de Gini pour les deux groupes (C et D) de la Division 2, et prouvez qu'ils sont égaux à : 0.48 et 0.5 respectivement.

| Groupe | Malin | Bénin |
|--------|-------|-------|
| C      | 6     | 4     |
| D      | 5     | 5     |
:::

Maintenant, en calculant le Coefficient d'Impureté de Gini moyen pour la Division 2, nous obtenons :

$$
\frac{n_c}{n_c + n_d} \cdot \text{Gini}_{c} + \frac{n_d}{n_c + n_d} \cdot \text{Gini}_{d}
$$

Nous obtenons :

$$
\frac{10}{10+10} \cdot 0.48 + \frac{10}{10+10} \cdot 0.5 = 0.49
$$

Pour conclure cette section, la Division 1 a un Coefficient d'Impureté de Gini moyen de 0.25 comparé à 0.49 pour la Division 2. C'est la division qui sépare le mieux les données.

Maintenant que nous avons un moyen de mesurer la qualité d'une division, nous pouvons simplement essayer de diviser les données à **toutes les valeurs de caractéristiques** pour **toutes les caractéristiques**, et choisir la meilleure.

## Essayer Différentes Divisions

Pour trouver la meilleure division des données, l'algorithme d'apprentissage du Decision Tree évalue **chaque caractéristique et valeur de division possible**, et choisit celle qui a le Coefficient d'Impureté de Gini le plus bas.

L'exemple ci-dessus ne montre que deux divisions différentes. Ce processus peut être répété pour toutes les caractéristiques et toutes les valeurs de division. À chaque essai, le Coefficient d'Impureté de Gini est enregistré. L'algorithme sélectionne ensuite la division atteignant le Coefficient d'Impureté de Gini le plus bas. Cela peut être représenté visuellement :

![Essayer toutes les combinaisons et choisir la première division atteignant le minimum du Coefficient d'Impureté de Gini](/images/trees/split_and_gini_vs_x1.png)

À partir de la valeur 1.76, la division **sépare parfaitement** les deux classes de données, atteignant un Coefficient d'Impureté de Gini de 0.

Mais que se passe-t-il lorsque les données ne sont **pas** entièrement séparables ? Pour ces cas, le Coefficient d'Impureté de Gini n'atteindra pas 0. Néanmoins, la division qui atteint le Coefficient d'Impureté de Gini le plus bas sera sélectionnée.

Cet essai et erreur de division peut être visualisé avec l'ensemble de données de diagnostic de tumeur :

![Diviser cet ensemble de données initial](/images/intro/scatter.png).

Nous essayons d'abord de diviser les données en utilisant le Périmètre Moyen des noyaux cellulaires. Le graphique linéaire suivant trace le critère d'Impureté de Gini pour **différentes valeurs de division** sur cette caractéristique.

![Essayer différentes valeurs de division pour le Périmètre Moyen](/images/trees/scatter_and_gini_vs_perimeter.png)

Ce Coefficient d'Impureté de Gini atteint un minimum d'environ 15.2 à une valeur de division d'environ 96.6.

La même chose pourrait être faite avec l'Aire Moyenne des noyaux cellulaires :

![Essayer différentes valeurs de division pour l'Aire Moyenne](/images/trees/gini_vs_area_and_scatter.png)

Le Coefficient d'Impureté de Gini atteint un minimum d'environ 16.5 à une valeur de division d'environ 885.7.

La meilleure division est obtenue en divisant les données selon le Périmètre Moyen à 96.6. Ce processus est répété chaque fois qu'un groupe est divisé.

## Conclusion

Le Coefficient d'Impureté de Gini est la mesure utilisée pour évaluer la qualité d'une division dans l'apprentissage des Decision Trees. Une bonne division partitionne les données en deux groupes homogènes.

Pour entraîner un modèle Decision Tree, l'algorithme trouve les meilleures divisions de données, en utilisant le Coefficient d'Impureté de Gini comme critère d'évaluation.

Le prochain chapitre explorera comment ce processus de division est appliqué **récursivement**.

## Solutions
:::{.solution #sol-gini}
@exr-gini

D'abord, calculez les probabilités :

$$
P(\text{malin}) = \frac{2}{2+8} = 0.2
$$
$$
P(\text{bénin}) = \frac{8}{2+8} = 0.8
$$


Maintenant, la probabilité de choisir d'abord une tumeur maligne, puis une tumeur bénigne :

$$
P(\text{malin puis bénin}) = P(\text{malin}) \cdot P(\text{bénin}) = 0.2 \cdot 0.8 = 0.16
$$

La probabilité de choisir d'abord une tumeur bénigne, puis une tumeur maligne :

$$
P(\text{bénin puis malin}) = P(\text{bénin}) \cdot P(\text{malin}) = 0.8 \cdot 0.2 = 0.16
$$

Additionnez les deux pour obtenir la probabilité de choisir des éléments de classes différentes :

$$\begin{aligned}
&= P(\text{malin puis bénin}) + P(\text{bénin puis malin}) \\
&= 0.16 + 0.16 = 0.32
\end{aligned}
$$

Le Coefficient d'Impureté de Gini est donc $0.32$. Cela correspond à notre intuition car ce nombre devrait être plus élevé que pour le groupe A, puisque le groupe B est plus mélangé.
:::

:::{.solution #sol-gini-split}
@exr-gini-split

**Groupe C**

| Groupe | Malin | Bénin |
|--------|-------|-------|
| C      | 6     | 4     |

$$
P(\text{malin}) = \frac{6}{6+4} = 0.6
$$
$$
P(\text{bénin}) = \frac{4}{6+4} = 0.4
$$

Maintenant, la probabilité de choisir d'abord une tumeur maligne, puis une tumeur bénigne :

$$
P(\text{malin puis bénin}) = P(\text{malin}) \cdot P(\text{bénin}) = 0.6 \cdot 0.4 = 0.24
$$

La probabilité de choisir d'abord une tumeur bénigne, puis une tumeur maligne :

$$
P(\text{bénin puis malin}) = P(\text{bénin}) \cdot P(\text{malin}) = 0.4 \cdot 0.6 = 0.24
$$

Additionnez les deux pour obtenir la probabilité de choisir des éléments de classes différentes :

$$
\begin{aligned}
&= P(\text{malin puis bénin}) + P(\text{bénin puis malin}) \\
&= 0.24 + 0.24 = 0.48
\end{aligned}
$$

Le Coefficient d'Impureté de Gini pour le groupe C est donc $0.48$.

**Groupe D**

| Groupe | Malin | Bénin |
|--------|-------|-------|
| D      | 5     | 5     |

$$
P(\text{malin}) = \frac{5}{5+5} = 0.5
$$
$$
P(\text{bénin}) = \frac{5}{5+5} = 0.5
$$

Maintenant, la probabilité de choisir d'abord une tumeur maligne, puis une tumeur bénigne :

$$
P(\text{malin puis bénin}) = P(\text{malin}) \cdot P(\text{bénin}) = 0.5 \cdot 0.5 = 0.25
$$

La probabilité de choisir d'abord une tumeur bénigne, puis une tumeur maligne :

$$
P(\text{bénin puis malin}) = P(\text{bénin}) \cdot P(\text{malin}) = 0.5 \cdot 0.5 = 0.25
$$

Additionnez les deux pour obtenir la probabilité de choisir des éléments de classes différentes :

$$
\begin{aligned}
&= P(\text{malin puis bénin}) + P(\text{bénin puis malin}) \\
&= 0.25 + 0.25 = 0.5
\end{aligned}
$$

Le Coefficient d'Impureté de Gini pour le groupe D est donc $0.5$.
:::
